{% extends "base.html" %}

{% block main_content %}
{% if SESSION['CONFIG_PARTIE'] %}
    <div class = "jeu-interface">
    <form method="post" action="jouer_a">
        <div class = "espace_equipe1">
            <h2>{{SESSION['EQUIPE_1'][3]}}</h2>
            {%if REQUEST_VARS['equipe1_active']%}               

            <div>
                <p>ALED</p>
                <label for = "sorts_equipe">Sorts disponibles :</label>
                <select id="sorts_equipe" name="sorts_equipe">
                    <option value="Non">--Sélectionner un sort--</option>
                    <option value="0">Sort de feu</option>
                    <option value="1">Sort de soin</option>
                    <option value="2">Armageddon</option> 
                </select> 
            </div> 
            {%endif%}
            
            <div class="grille-morpion-container">
            {%for i in range(0,REQUEST_VARS['nb_morpion_equipe_1'])%}
                <div class="morpion-container">
                {%if REQUEST_VARS['equipe1_active']%}
                    <input type="checkbox" id="morpion_{{ REQUEST_VARS['morpion_equipe_1'][i][0] }}" value="{{ REQUEST_VARS['morpion_equipe_1'][i][0] }}" name="morpion_selectionne[]">
                {% endif %}
                    <img src="{{ SESSION['DIRECTORY'] }}{{ REQUEST_VARS['morpion_equipe_1'][i][2] }}" alt="{{REQUEST_VARS['morpion_equipe_1'][i][1]}}" class="image-morpion">
                </div>
            {%endfor%}
            </div>
        </div>

        <div class = "espace_grille">
            <div>
                <input type="submit" value="Valider le déplacement" name ="valider_deplacement">
                {% if REQUEST_VARS['message_erreur'] %} <!--si on recoit un message d'erreur du controleur apres la gestion de la methiode post-->
                    <br><div style="color: red; background-color: #FFDDDD; padding: 10px; border: 1px solid red; border-radius: 5px;"><p>{{ REQUEST_VARS['message_erreur'] }}</p></div>
                {% endif %}
                {% if REQUEST_VARS['message_victoire'] %} <!--si on recoit un message de victoire du controleur apres la gestion de la methiode post-->
                    <br><div style="color: green; background-color: #DDFFDD; padding: 10px; border: 1px solid green; border-radius: 5px;"><p>{{ REQUEST_VARS['message_victoire'] }}</p></div>
                {% endif %}
            </div>
            <div class="grille-container">
            {%for i in range(SESSION['CONFIG_PARTIE'][2])%}
                {% set ligne = SESSION['TAB'][i] %} 
                {% if ligne is iterable and ligne|length >= SESSION['CONFIG_PARTIE'][2] %}
                <div class="row">
                {%for j in range(SESSION['CONFIG_PARTIE'][2])%}
                        {% set case = ligne[j] %}
                            {% if case is iterable and case|length > 0 and case[0] %} <!--si la case de la grille contient un morpion, on affiche l'image de ce morpion-->
                                {% if SESSION['TAB'][i][j][0] == SESSION['EQUIPE_1'][0] %}
                                <div style ="width: 160px;height: 120px;border: 1px solid #333; background-color: #ca1414 ; display: flex;justify-content: center;align-items: center;position: relative"id="{{i}},{{j}}">
                                {%elif SESSION['TAB'][i][j][0] == SESSION['EQUIPE_2'][0]%}
                                <div style ="width: 160px;height: 120px;border: 1px solid #333;background-color: #0848d3;display: flex;justify-content: center;align-items: center; position: relative"id="{{i}},{{j}}">
                                {%endif%}
                                    <img src="{{ SESSION['DIRECTORY'] }}{{ SESSION['TAB'][i][j][1][2] }}" alt="Morpion" class="image-morpion2"> <!-- on affiche le morpion et ces points de vie-->
                                  
                                    <p>PV : {{SESSION['TAB'][i][j][1][3]}}</p>
                                    <input type="checkbox" value="{{i}},{{j}}" name="case_cible[]" id="case_cible">
                                </div>  
                            {%else%} <!-- sinon on affiche le bouton de selection-->                                                                                                                                                                
                                <div class="cellule" id="{{i}},{{j}}">
                                    <input type="checkbox" value="{{i}},{{j}}" name="case_cible[]" id="case_cible">
                                </div>                                                                                                                                                            
                            {% endif %}
                {%endfor%}
                </div>
                {% else %}
                    <p>Erreur , chargement de la grille</p>
                {% endif %}
            {%endfor%}
            </div>
            <div>
                <h3>Tour restant : {{REQUEST_VARS['nb_tours_restant']}}</h3>
                    {%if REQUEST_VARS['equipe1_active']%}               
                        <h3 style = "font-style: italic ; color : #ca1414 ">Équipe en action : {{SESSION['EQUIPE_1'][3]}}
                    {%else%}
                        <h3 style = "font-style: italic ; color : #0848d3 ">Équipe en action : {{SESSION['EQUIPE_1'][3]}}
                    {%endif%}
                </h3>
            </div>
        </div>

        <div class = "espace_equipe2">
            <div class="grille-morpion-container">
            {%for i in range(0,REQUEST_VARS['nb_morpion_equipe_2'])%}
                <div class="morpion-container">
                {%if REQUEST_VARS['equipe1_active']%}
                {%else%}
                    <input type="checkbox" id="morpion_{{ REQUEST_VARS['morpion_equipe_2'][i][0] }}" value="{{ REQUEST_VARS['morpion_equipe_2'][i][0] }}" name="morpion_selectionne[]" >
                {% endif %}                   
                    <img src="{{ SESSION['DIRECTORY'] }}{{ REQUEST_VARS['morpion_equipe_2'][i][2] }}" alt="{{REQUEST_VARS['morpion_equipe_2'][i][1]}}" class="image-morpion">
                </div>
            {%endfor%}
            </div>
            {%if not REQUEST_VARS['equipe1_active']%}               

            <div>
                <label for = "sorts_equipe">Sorts disponibles :</label>
                <select id="sorts_equipe" name="sorts_equipe">
                    <option value="Non">--Ne pas lancer un sort--</option>
                    <option value="0">Sort de feu</option>
                    <option value="1">Sort de soin</option>
                    <option value="2">Armageddon</option>   
                </select>

                <label for="attaque">selectionner l'attaque :</label>
                    <input type ="checkbox" id="attaque" name="attaque" value="attaque">
            </div>
            {%endif%}
            <h2>{{SESSION['EQUIPE_2'][3]}}</h2>
        </div>
    </form>
    </div>


{%else%}
    <p> Aucune partie n'est configurée. Veuillez créer une partie dans le menu "créer une partie". </p>
{% endif %}
{% endblock %}